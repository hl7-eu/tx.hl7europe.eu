<!DOCTYPE html>
<html lang="en-US"> <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Starting and Stopping | HL7 EU Terminology</title> <meta name="generator" content="Jekyll v4.3.4"> <meta property="og:title" content="Starting and Stopping"> <meta property="og:locale" content="en_US"> <meta name="description" content="Documentation"> <meta property="og:description" content="Documentation"> <link rel="canonical" href="http://localhost:4000/server/start-stop.html"> <meta property="og:url" content="http://localhost:4000/server/start-stop.html"> <meta property="og:site_name" content="HL7 EU Terminology"> <meta property="og:type" content="website"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Starting and Stopping"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation","headline":"Starting and Stopping","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/hl7-eu-logo.jpg"}},"url":"http://localhost:4000/server/start-stop.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewbox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewbox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewbox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="HL7 EU Terminology"></div> HL7 EU Terminology </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewbox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list">
<li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li>
<li class="nav-list-item">
<button class="nav-list-expander btn-reset" aria-label="toggle items in Server setup category" aria-pressed="false"> <svg viewbox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/server/" class="nav-list-link">Server setup</a><ul class="nav-list">
<li class="nav-list-item"><a href="/server/setup-vm.html" class="nav-list-link">Setup</a></li>
<li class="nav-list-item"><a href="/server/start-stop.html" class="nav-list-link">Starting and Stopping</a></li>
<li class="nav-list-item"><a href="/server/updates.html" class="nav-list-link">Updating the server</a></li>
</ul>
</li>
<li class="nav-list-item">
<button class="nav-list-expander btn-reset" aria-label="toggle items in Content category" aria-pressed="false"> <svg viewbox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/content/" class="nav-list-link">Content</a><ul class="nav-list">
<li class="nav-list-item"><a href="/content/adding-content.html" class="nav-list-link">Adding content</a></li>
<li class="nav-list-item"><a href="/content/creating-content.html" class="nav-list-link">Creating content</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="/using-server.html" class="nav-list-link">Usage</a></li>
<li class="nav-list-item"><a href="/testing.html" class="nav-list-link">Testing</a></li>
</ul> </nav> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HL7 EU Terminology" aria-label="Search HL7 EU Terminology" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/server/">Server setup</a></li> <li class="breadcrumb-nav-list-item"><span>Starting and Stopping</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 id="start"> <a href="#start" class="anchor-heading" aria-labelledby="start"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start </h2> <p>The server configuration is contained in <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> <a href="https://github.com/hl7-eu/tx.hl7europe.eu/blob/master/server/docker-compose.yml">(source)</a>. To run it, <strong>the preferred way</strong> is to run <code class="language-plaintext highlighter-rouge">sudo docker-compose up --pull</code> to pull the container image and start the server. Alternatively, pull the images with <code class="language-plaintext highlighter-rouge">sudo docker compose pull</code> and then start with <code class="language-plaintext highlighter-rouge">sudo docker compose up</code>.</p> <p>The start cycle of the server is:<br> When the binary is launched, the server looks for the defined configuration location where the config.ini file is located.<br> It then loads the configuration from the location indicated in that config.ini file. This configuration includes server parameters, ports, endpoitns, etc, as well as the content that should be loaded to the server.<br> After loading the configuration and checking if all required content is present, it loading the packages and cache. After this, it starts the web server.<br> After the web server is up, the server still runs a <a href="#background-loading">background loading process</a> to fetch and index the content. Some time after launching the executable (configured in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file) the health check starts periodically checking if the server is responding. <br clear="ALL"> <img src="/assets/images/timeline.png" alt="Timeline" width="800"></p> <p>During the startup, some messages will appear - these are ok to ignore:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tx-fhir-eu-1  | The XKEYBOARD keymap compiler (xkbcomp) reports:
...
tx-fhir-eu-1  | &gt; Warning:          Could not resolve keysym XF86SidevuSonar                                                                                                                                          
tx-fhir-eu-1  | &gt; Warning:          Could not resolve keysym XF86NavInfo                                                                                                                                              tx-fhir-eu-1  | Errors from xkbcomp are not fatal to the X server                              
</code></pre></div></div> <p>The server starts by checking the [[Configuration]] and starts loading the packages. This is the critical part - if there are any issues with the configuration, they will show up here. A normal configuration would show:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tx-fhir-eu-1  | 05:34:40 00:00:00 3467b 0% FHIR Server 3.4.27-SNAPSHOT Linux/FreePascal, Development Build                                                                                                            tx-fhir-eu-1  | 05:34:40 00:00:00 3518b 0% Running on "ce7850bd458a": "Ubuntu" v"24.04.1 LTS (Noble Numbat)". 47.0 GB/ 0 bytes memory
tx-fhir-eu-1  | 05:34:40 00:00:00 3588b 0% Logging to /tmp/fhirserver.log. No Debugger.                                                                                                                               
tx-fhir-eu-1  | 05:34:40 00:00:00 3671b 0% /root/fhirserver/fhirserver -cmd exec -cfg /root/fhirserver/config/config.ini (dir=/root/fhirserver)                                                                       
tx-fhir-eu-1  | 05:34:40 00:00:00 3671b 0% Command Line Parameters: see https://github.com/HealthIntersections/fhirserver/wiki/Command-line-Parameters-for-the-server                                                 
tx-fhir-eu-1  | 05:34:40 00:00:00 3403b 0% Loading Dependencies                                                                                                                                                       
tx-fhir-eu-1  | 05:34:40 00:00:00 325kb 0% TimeZone: Etc/UTC @ UTC                                                                                                                                                    
tx-fhir-eu-1  | 05:34:40 00:00:00 325kb 0% Loaded
tx-fhir-eu-1  | 05:34:40 00:00:00 325kb 0% Local config: /root/fhirserver/config/config.ini (exists = True)
tx-fhir-eu-1  | 05:34:40 00:00:00 327kb 0% Read Zero Config from file:/root/fhirserver/config/config.json
tx-fhir-eu-1  | 05:34:40 00:00:00 358kb 0% Local Config in /var/cache/txcache/fhir-server/
tx-fhir-eu-1  | 05:34:40 00:00:00 329kb 0% Actual config: /var/cache/txcache/fhir-server/fhir-server-config.cfg
tx-fhir-eu-1  | 05:34:40 00:00:00 431kb 0% Using Configuration file /var/cache/txcache/fhir-server/fhir-server-config.cfg
tx-fhir-eu-1  | 05:34:40 00:00:00 434kb 0% Start Telnet Server on Port 44123
tx-fhir-eu-1  | 05:34:40 00:00:00 439kb 0% Thread start  Telnet Server 00007FF437A966C0
tx-fhir-eu-1  | 05:34:40 00:00:00 460kb 0% Run Number 8
tx-fhir-eu-1  | 05:34:40 00:00:00 460kb 0% Load Terminologies
tx-fhir-eu-1  | 05:34:41 00:00:00 5Mb 0% load ucum-essence-2.2 from /var/cache/txcache/fhir-server/ucum-essence-2.2.xml
</code></pre></div></div> <p>This line</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tx-fhir-eu-1  | 05:34:40 00:00:00 325kb 0% Local config: /root/fhirserver/config/config.ini (exists = True)
</code></pre></div></div> <p>confirms that the local Configuration was found and is being used.</p> <p>The line</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tx-fhir-eu-1  | 05:34:41 00:00:00 5Mb 0% load ucum-essence-2.2 from /var/cache/txcache/fhir-server/ucum-essence-2.2.xml
</code></pre></div></div> <p>confirms the server is loading the files</p> <p>It takes several minutes (3 to 10, possibly more) for the server to download and open all the packages and process the cache files.</p> <p>At the end the log will say</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tx-fhir-eu-1  | 05:36:54 00:02:14 6Gb 0% Start Web Server:
tx-fhir-eu-1  | 05:36:54 00:02:14 6Gb 0%   http: listen on 80, Limited to 50 connections
...
tx-fhir-eu-1  | 05:36:55 00:02:15 6Gb 0% started (135secs)
</code></pre></div></div> <p>At this moment the server is available on http://tx.hl7europe.eu : <br clear="ALL"> <img src="/assets/images/server-up.png" alt="Server Up" width="800"></p> <h2 id="background-loading"> <a href="#background-loading" class="anchor-heading" aria-labelledby="background-loading"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Background loading </h2> <p>During the background load, fetching a resource directly produces the expected results:<br> For example when fetching <code class="language-plaintext highlighter-rouge">http://tx.hl7europe.eu/r4/ValueSet/results-coded-values-laboratory-uv-ips</code></p> <p><br clear="ALL"> <img src="/assets/images/server-get.png" alt="Server GET" width="800"></p> <p>However, a search like <code class="language-plaintext highlighter-rouge">http://tx.hl7europe.eu/r4/ValueSet?url=http://hl7.org/fhir/uv/ips/ValueSet/results-coded-values-laboratory-uv-ips</code> will return an error:</p> <p><br clear="ALL"> <img src="/assets/images/server-not-running.png" alt="Server not running" width="800"></p> <h2 id="updating-the-server"> <a href="#updating-the-server" class="anchor-heading" aria-labelledby="updating-the-server"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Updating the server </h2> <p>To update the server binaries, simply update the docker image <code class="language-plaintext highlighter-rouge">docker compose pull</code></p> <h2 id="health-check"> <a href="#health-check" class="anchor-heading" aria-labelledby="health-check"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Health check </h2> <p>The server has a health check that checks every 2 minutes with 5 retries if the server is alive and responds to a request. That request is currently on <code class="language-plaintext highlighter-rouge">http://localhost:80/r4/metadata</code>. The request is only starting after 10 minutes, to give the server time to startup.</p> <p>After 10 minutes of consecutive failure, the server is automatically restarted.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
